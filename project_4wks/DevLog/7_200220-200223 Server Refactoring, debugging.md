# 7_200220-200223 Server Refactoring, debugging, Deployment 발표준비



1. 서버 리펙토링을 시작했다.( MVC 패턴)

   - 어찌보면 MVC패턴을 쓰는 것이 너무나도 당연하고, 설계 단계에서 부터 일어났어야 하는 것이 맞다.
     *(변명하자면)* 나나 성현님이나 2주 프로젝트에서 프런트였고.. 기획, 설계단계에서 (스프린트 때 이후로 ) 정말 오랜만에 만나는 express와, 새로운 스택에 대한 부담감이 더 먼저 다가와서, 또, 공식문서들에서는 당연히 간단한 예시들을 위해.. *router에서 모든 처리를 하는 코드들*을 보여주기 때문에 설계 단계에선 MVC패턴에 대해 정말 생각조차 하지 못한것같다.
     
     - MVC패턴으로 리펙토링을 진행하면서 겪었던 질문들
       
       우선 express의 MVC패턴에 대하여 검색을 하다가 *이렇다 정해진 정답* 이 없다는 것을 많이 느꼈다. 사실 그래서, 결단력 없는 나로서는.. Spring으로 진행했던 프로젝트를 다시 열어보기도 하고, typescript MVC패턴 예시를 한참 들여다보기도 하다가, 결국 codestates helpdesk에 [고민되었던 부분](https://github.com/codestates/help-desk/issues/1219)을 올리기도 하였다.
       *(저 당시에는 아무리 찾아도 express 자체로 model부분을 확연히 분리한 코드를 보지 못하였다..)*
       지금은 두현님이 정말 친절한 답변을 달아주셨지만, 발표일이 몇일 남지않았던 당시에는 마음이 급했기 때문에 오피스 아워시간에 들어가 *승환님*에게 MVC패턴에 대한 질문을 정말 많이 날리었다. *(옆자리에서 **path aliases**를 설정하면서 에러를 겪고있던 성현님도 함께 질문해서 한시간동안의 오피스아워를 거의 둘이 잠식하였다 ^^;;)*
       
       > 여담이지만, **path aliases** 는 오피스 아워때  승환님이 함께 노력해주셨음에도 해결하지 못했고, 성현님의 수많은 설정 에러 끝에 적용을 하긴 했으나..
       > 알려진 설정들과 똑같이했음에도 계속해서 *알 수 없는.. 에러가 발생했기에..*
       > 결국 우리의 파일 구조가 그렇게 복잡한 편이 아니니 index.ts에 파일을 모아 export시켜 import구간을 하나로 줄이기로 하였다.
       
       
       
       > 사실.. import부분의 코드 줄은 *나는* 별신경이 쓰이진 않았다... (나는.. 자바로 eclipse를 사용하면서 import부분이 *자동 숨김* 이 되었기에.. 그래서 import부분은 긴게 익숙하게도 했고 *원래 길겠거니..* 하고 신경쓰지 않았던것같다.) 그래서 성현님이 import 구간을 줄이려고 시도해주셔서 굉장히 새롭게 다가왔다!
       > 하지만 성현님이 노력해주신덕에 한결 깔끔해짐..!
       
        
       
       음.. 당시에는 이렇게까지 *본질적인* 질문은 아니였던것 같지만(많이 횡설수설 했던 것 같다.), MVC 패턴에 대한 질문은 정리하면 이러한 두가지 내용이였다.
       
       1. **Express에 정해진 패턴이 없는 것 같습니다.**
          (분리하려고 MVC와, DAO에 대한 검색을 하면, Spring에 대한 글이 대다수여서 유사히 해도 될지.. 확신이 들지 않습니다)
       
       2.  **router와, controller의 분리 의의를 잘 모르겠습니다.**
          (MVC패턴은 Framework마다 다르고 정해진 답이 없고 상대적이라고 알고있는데, router와 controller를 반드시 분리 해주어야 할까요?, router를 controller로 사용하면 안되는 걸까요?)
       
       3. service 단에 interface*가 지금 상황에서 반드시 필요할까요?
       
          
       
       여기에 대하여 승환님이 주신 답은 *Spring MVC*패턴과 유사히 진행을 해도 된다는 것과, (지금 상황에서는)router를 controller로 사용해도 큰 상관 없을 것 같으며, interface단은 지금 상황에서 크게 상관이 없을 것 같다는 말씀을 해주시었다.
       그래서 **우선**은, SpringFramework의 MVC2패턴 *(이전 프로젝트)*과 유사히 바꾸기로 하고 리펙토링을 시작했다.
       
       > 사실, 리펙토링은 막상 시작하지 정말 얼마 걸리지 않았던 것 같다.
       > *반나절 정도..?*
       > 그런데 검색을하고 확신을 얻고 디테일한 구조를 설계하는 데 까지 또 반나절은 걸린것같다...
       
       
       
       > 뭐..........방향성 설정은 정말로 중요하니까!
       
       
       
       아무튼, Spring Framework로 진행했던 프로젝트를 뒤적거려 참고하고 성현님께 간단히 진행 방향에 대해서 설명드리고, 회의를 한 후 파트를 나누어 리펙토링을 함께 진행했다.
       
       > 지금 생각해도 성현님은 늘  내가 개떡같이 말해도 찰떡같이 알아들으신다.. 크으..bb
       >
       > 내가 설명하는 법이 안늘었따면.. 성현님이 잘 알아들으셨기 때문일거야..!
       
       
       
       리펙토링은 생각보다 금방끝났다.
     
   - Spring으로 진행하였던 프로젝트를 보다가 깨달은 것인데, *예외처리* 에 대한 패턴을 이미 Spring프로젝트와 유사히 처리해놓고, 예외사항에 대한 response가 일정하지 못했다.
   
     음... 그리고 디버깅을 이 시점에 소소히 시작하면서,  어디서 나는 에러인지 파악하지 못하는 불편함이 잇었기 때문에 
     **에러처리**에 대한 필요성을 깊이 느끼기 시작했다.
   
2. 배포! **Deployment**
   리펙토링이 끝나고, 아마 밤 10시쯤이였던것같다.
   이미 성현님이 RDS로 배포를 해놓았던 상황이었고, 성현님은 아마 리펙토링이 조금 남아있었던 듯 하다. 혹은 성현님이 클라이언트에 손보던 곳에 대한 논의를 클라이언트담당 팀원들과 이야기를 나누었던것 같기도 하다.
   내가 맡은 분의 에러가 없는 것을 확인하고, EC2에 올리기로 하였다.

   솔직히, AWS EC2에 대해서 잘 아는것이 아니지만, 그래서 더 해보고싶었다.
   업로드를 하게 되는 계정과 컴퓨터에서 관리를 하게될것같았고, 그래서 약간은 내 계정으로 해보고싶었다고 주장했던것같은데, RDS를 이미 업로드 해놓았으니, 하나로 관리하자고 성현님이 강력하게 주장하여서 성현님 컴퓨터에서 진행됬다.
   사실 마음과 같아선, EC2로 업로드를 하면서 pm2와 기타 설정들을 다 보고싶었는데..
   음.. 진행 하다가 왜인지 정신차려보니까 EC2 인스턴스만 생성해놓고  git clone도 받지 못하고 내쫓겨져 있었다...

   여태까지 프로젝트를 하면서 한번도 배포를 해본적이 없어서 (해도 남들이 하거나,, (시간이 없어서)아무도 진행 하지않거나.. 했어서..) 정말 해보고싶었는데..

   음.. 그래도 그건 내가 프로젝트가 끝나고도 할 수 있는 것이었는데 하지 않았던 것이고..
   아쉽긴 하지만, 영어력이나 서치력이나.. 위기대처력이나.. 성현님이 더 잘할 수 있을거라 생각하기 때문에 팀을 생각하면 이렇게 진행된게 더 맞았다고 생각한다..

   나중에 사이드프로젝트 후딱 해서 올릴수도 있는거고..!
   *(내가 게으르지 않다면)*하다못해 자기소개 페이지라도 올릴수도 잇는거구..^^;;

   - ec2에 막상 클론 받아 놓으니, ts파일이 메모리 부족으로 렌더되지 않았다.
     성현님이 결제할까요 물어보셔서 함께 고민해보다가 dist파일만 올리면 어떻냐는 의견을 내었고, 그 결과 잘 올라가게 되었다..! *dist 파일만 따로 git을 파서 올려야 한다는 번거로움이있지만..*

     > 찾아보니 메모리 부족으로 빌드가 되지않는 에러에 직면한 사람들이 많았는데 모두 `결제를 해라`하는 말을 하고있어서..  잠시 고민했는데..
     > 빌드 파일을 올리는것으로 해결했다..
     > 잠깐 생각을 했던건
     > 왜 빌드 파일을 안올리고 결제하라는 말을 하는거지?? 무슨 이유가 있는걸까??
     > 아직도 잘 모르겠다.
  
     
   

3. 이후 디버깅과 함께 에러 리펙토링을 진행하였다.
   사실 에러와 예외차리에 대한 부족함을 알고있었고 *(그래서 디버깅 할 때 마다 뭔가 불-편 한 생각이 들었음..)* 
   실제로 디버깅을 할 때 어디에서 에러가 나는지 추측을 해서 콘솔을 찍는방식(;;)으로 말도안되는 진행을 한고있다는 생각이 들어서..

   1. spring log4j이가 굉장히 편했다는 생각이 들엇다. 로거를 쓰자..!
   2. 예외처리에 대한 응답을 동일히 통일해야겠다.

   라는 생각이 들어서 우선 express의 에러처리에 대해 공부하기 시작했다.
   사실 굉장히 추상적인 글들을 많이 보았는데, 실질적으로 도움이 된 글은 아래 두개였 던 듯 하다.

   - [에러 처리를 위한 익스프레스 가이드](http://jeonghwan-kim.github.io/node/2017/08/17/express-error-handling.html#asyncawait-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0)
   - [javascript 에러 처리 방법](https://medium.com/@Dongmin_Jang/javascript-에러-처리-방법-e6cecca61974)

   위 두개를 정독하고 이러 이러한 작업을 할거라 성현님께 설명을 드리고 (동의를 해주셔서)진행을 하였다.
   사실 위 두개는 정말.. *(역시나 또 )* 당연한 개념 이였는데 왜.. 하지않고있었을까...!
   아무튼 에러처리에 관한건.. 음.. 공부하고 적용하는데 까지 반나절동안 뚝딱 잘 했는줄 알앗는데 내가 멍청한 실수를 하는 바람에 (모르고있다가) 발표 전날 시연을 준비하면서 발견하여.. 다시 발표전날까지 꾸역꾸역 붙잡고잇었다..
   다행이도 결국엔 해결하긴 했다..

   > 하지만.. 혹시 안될까 정말 불안하고 초조했다..(기술발표 주제로 정하기도 했기 때문에..피피티도 다만들어놨는데 혹시라도 안되면 어떻게하지 하는 생각을 많이 햇다..!
   > 별거아니였는데..  바보같이..
   > 아무튼 개인적으로 신경이 많이 쓰였던 부분이라  에러에 관한건 기술 주제로 발표하기도 하였고 정리할 부분이 있어 추후에 *(버려두었던)* 블로그에 (자잘한 실수를 했던것도)정리하여 올릴 생각이다.

   

4. 발표 준비를 하면서 
   시연용 db를 팀원들과 함께 채웠고, 발표준비를 하기시작했다. (리펙토링을 하고싶은 부분이 client와 server 모두 존재하였는데, 발표 후, 모의면접이 끝난 후 천천히 진행하기로 하였다)
   나는 그 때 기술 발표 영상도 만들지 못해 초조한 상태였고, 그와중에 졸리고, 감기몸살에 걸려 살짝은 제정신이 아니였기에 그리 적극적으로 참여하진 못했던것같다. 팀원들에게 정말 죄송하게 생각한다.

   > 음.. 이번 프로젝트가 솔직히.. 열심히 하기는 하엿지만, 막 예전에 Java로 프로젝트 하면서 했던것 처럼 죽을동 살동 한 것 같지는 않은데,.. 왜 병치레는 종류별로하는지..
   > 감기몸살기운도 으슬으슬 계속 있엇고, 다래끼가 정말로 크게나서 일주일은 눈도 제대로 못뜨고 프로젝트를 했던것같다.. 음..

   다행이 에러처리에 관한 에러가 정말 허무하게 잘 해결되었고, 내 기술영상도 잘 제작하엿고, 데모데이 발표도 잘 하신것 같았다.  *(도움을 그래도 드리려고는 했지만.. 별로 되지는 못한 것 같다...)*

   *그리고 사실 나는 여태까지 프로젝트에서 back-end stack을 더 많이 썼지만, 디자인 불편러라 CSS3에 매우.. 관심을 갖고 공부했었는데.. 그리고.. 프로젝트할때마다 로고를 제작하고 매우 디자인이 불편한것에 대해서 참지 못했는데.. 이번에 우리팀 수지님과 대연님이 프런트를 (기능은 당연하고 )너무 깔끔히 디테일을 잡아주셔서 정말 그럴싸한 프로젝트가 탄생헌것같다.. *

아래 링크에서 데모데이와 기술발표, 프로젝트 소개를 볼 수 있음!

[데모데이 링크](https://www.youtube.com/watch?v=lQgI9r0On2M&t=)

[기술 발표 및 프로젝트 소개 페이지](https://www.notion.so/1-CodeStake-DediCats-38788b87b32a4c9d964105add197ad94)

이렇게나 잘, 그럴싸한 기능과 외향을 갖춘 프로그램을 만들면서, 코드도 쓰레기더미가 아니라 정갈한 코드를 짜본것은 정말 처음이었던것같다.
여태까지의 경험했던 프로젝트에서는 너무나 내게 진 짐이 너무 무거웠고, 항상 시간에 쫓기며 만들어 돌아만가고, 정갈하지도 못하였고 비효율적 행태도 많았어서.. 정말 발표를 하고나면.. 두번다시 켜보고싶지 않은 코드들이였는데 프로젝트를 하면서 리펙토링까지 완료된것은 정말 처음이여서 정말 눈물이 나게 감격스러운것같다. 

또, 서로 재촉하지 않고 서로의 역할을 묵묵히 해주고, 서로의 의견을 존중해 주고, 심지어 마무리까지 잘 하게되어서 정말로 팀원분들께 감사하다. 코딩뿐만아니라 의사소통에서도 그렇고, 태도와 협력 등등.. 정말 많은것들을 배운것같다.

아마도 안읽으시겠지만 정말 수고많으셨고 정말 감사합니다..